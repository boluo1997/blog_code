-- 找出没有管理费居间费经纪费的项目

-- 宽表 
+-------------------------------+-----------------------------------+-------------------+----------+-----------------------------------+---------+-----------------------------------+------+------+--------+-------+-----+-------+---------+------+-----+----+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+----+
|key                            |rev                                |ts                 |biz_id2   |biz                                |store_id2|store                              |biz_id|device|store_id|payment|order|user_id|device_id|expend|model|cost|share                                                                                                                                                              |hash|
+-------------------------------+-----------------------------------+-------------------+----------+-----------------------------------+---------+-----------------------------------+------+------+--------+-------+-----+-------+---------+------+-----+----+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+----+
|16123D66c:4129:8               |1574611200QD66ca5c3f:4129131:8:21  |2019-11-25 00:00:00|null      |[44, 天鹅堡,,,,,]                   |147      |[147, B1层电梯旁边,]                 |null  |null  |null    |null   |null |null   |null     |null  |null |null|[SW-FWHT-2018-X44-M1, 杭州市委员会, 120202628425, 主营业务成本.管理费（分成费）,, [[-0.4, 0]], -0.0, 2019-10-25 00:00:00]                                                 |1574|
|16123Hef5:4047:12              |1571932800QHef5320a1:4047990:12:019|2019-10-25 00:00:00|null      |[3, 西溪校区,,,,,]                  |560      |[560, 西溪北园,]                     |null  |null  |null    |null   |null |null   |null     |null  |null |null|[SW-LYHT-2018-X3-/561/153-S1, 浙江有限公司, 20100908, 主营业务成本.居间费（分成费）,, [[-0.3, 0]], -0.09, 2019-09-25 00:00:00]                                            |1571|
+-------------------------------+-----------------------------------+-------------------+----------+-----------------------------------+---------+-----------------------------------+------+------+--------+-------+-----+-------+---------+------+-----+----+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+----+



-- 第一种方法, 类似于子查询, 会查询两遍
select distinct a.biz_id2
from table_a a
    except
select distinct b.biz_id2
from table_a b
where b.share.`策略号` like 'SW-FUHT%'
   or b.share.`策略号` like 'SW-LYHT%'




-- 第二种方法
select a.biz_id2 as id2,
       concat_ws(',', concat(collect_set(biz.`编号`),
                             collect_set(biz.`名称`))) as biz, count(0) as sum1
from table_a a
group by a.biz_id2
having sum(if(a.share.`策略号` like 'SW-FUHT%'
                  or a.share.`策略号` like 'SW-LYHT%'
                  or a.share.`策略号` like 'SW-JJHT%', 1, 0)) < 1
   and sum(if(biz is null, 0, 1)) > 0
   and a.biz_id2 is not null